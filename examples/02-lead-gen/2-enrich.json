{
  "data": {
    "source": "out/13-industry-search/companies.csv",
    "limit": 2
  },
  "globals": {
    "model": "google/gemini-3-pro-preview",
    "tmpDir": "out/13-industry-search/.tmp",
    "outputPath": "out/13-industry-search/companies_enriched.csv"
  },
  "steps": [
    {
      "plugins": [
        {
          "type": "website-agent",
          "url": "{{link}}",
          "schema": {
            "type": "object",
            "description": "Extract contact details, decision maker info, and identify the Top Offer of the business.",
            "properties": {
              "isIndustry": {
                "type": ["boolean", "null"],
                "description": "Is this company offering {{industry}}?"
              },
              "isIndustryReason": {
                "type": ["string", "null"],
                "description": "Reason why this company is or is not offering {{industry}}."
              },
              "companyName": {
                "type": ["string", "null"],
                "description": "The official name of the company (e.g. GmbH, AG, etc.). Optional."
              },
              "address": {
                "type": ["object", "null"],
                "description": "The postal address of the company. Optional.",
                "properties": {
                  "street": { "type": ["string", "null"], "description": "Optional." },
                  "zip": { "type": ["string", "null"], "description": "Optional." },
                  "city": { "type": ["string", "null"], "description": "Optional." }
                }
              },
              "decisionMaker": {
                "type": ["object", "null"],
                "description": "The best person to contact for business decisions. Look for the CEO (Gesch채ftsf체hrer), Owner (Inhaber), or Founder. If not available, look for Head of Department or similar high-level roles. Optional.",
                "properties": {
                  "firstName": { "type": ["string", "null"], "description": "Optional." },
                  "lastName": { "type": ["string", "null"], "description": "Optional." },
                  "role": { "type": ["string", "null"], "description": "The job title (e.g. CEO, Gesch채ftsf체hrer). Optional." },
                  "email": { "type": ["string", "null"], "description": "Direct email of the decision maker. Optional." },
                  "phone": { "type": ["string", "null"], "description": "Direct phone number of the decision maker. Format: International format (e.g. +49 30 123456). Optional." }
                }
              },
              "webDesignAgency": {
                "type": ["object", "null"],
                "description": "Information about the agency that built the website, usually found in the footer (e.g. 'Made by...', 'Webdesign by...'). Important: We need the web design agency which build the site and not the author of the theme. Do not include generic homepage builders like Jimdo, Wix, Squarespace, etc. Optional.",
                "properties": {
                  "name": { "type": ["string", "null"], "description": "Optional." },
                  "url": { "type": ["string", "null"], "description": "The URL of the web design agency. Optional." }
                }
              },
              "topOffer": {
                "type": ["object", "null"],
                "description": "Identify ONE single, concrete, purchasable 'Top Offer'. It must be the MAIN product or service this business is trying to sell. Look for the 'Hero' offer featured on the homepage, the core service that defines the business. Do NOT simply pick the most expensive one. Do NOT summarize multiple offers (e.g. 'Various Yoga Classes'), instead pick the specific core one (e.g. 'Hatha Yoga 10-Week Course').",
                "properties": {
                  "name": {
                    "type": ["string", "null"],
                    "description": "The specific name of the single offer (e.g. 'Open Water Diver Course', 'Full Body Massage 60min'). (in German)"
                  },
                  "price": {
                    "type": ["number", "null"],
                    "description": "The price of this specific offer in Euros (e.g. 2990). Do not include currency symbols."
                  },
                  "description": {
                    "type": ["string", "null"],
                    "description": "A detailed description of exactly what is included in this specific offer. Do not list general services."
                  },
                  "link": {
                    "type": ["string", "null"],
                    "description": "The specific URL to this offer's page."
                  },
                  "bookingPage": {
                    "type": ["string", "null"],
                    "description": "Link to the booking page, contact form, or checkout page specifically for this offer."
                  },
                  "reason": {
                    "type": ["string", "null"],
                    "description": "Reason why this specific item was selected as the top offer (e.g. 'Featured prominently on homepage', 'Core business service'). (in German)"
                  }
                }
              },
              "top5Offers": {
                "type": ["string", "null"],
                "description": "A bulleted list of the top 5 offers found on the website. Each bullet point must include the Offer Name, Price (if available), Appointment info (if relevant), and a short description of what it is."
              }
            }
          },
          "output": {
            "mode": "merge"
          }
        }
      ]
    },
    {
      "plugins": [
        {
          "type": "validation",
          "schema": {
            "type": "object",
            "properties": {
              "isIndustry": { "const": true },
              "companyName": { "type": "string", "minLength": 1 },
              "decisionMaker": {
                "type": "object",
                "properties": {
                  "firstName": { "type": "string", "minLength": 1 },
                  "lastName": { "type": "string", "minLength": 1 }
                },
                "required": ["firstName", "lastName"]
              }
            },
            "required": ["companyName", "decisionMaker", "isIndustry"]
          }
        }
      ]
    },
    {
      "prompt": "You are a data extraction engine. Extract the LinkedIn URL for {{decisionMaker.firstName}} {{decisionMaker.lastName}} from the search results.\nOutput Rules:\n1. Return ONLY the URL (starting with https://).\n2. If no valid personal profile is found, return an empty string.\n3. Do NOT return JSON, Markdown, quotes, or explanations.",
      "output": {
        "mode": "column",
        "column": "linkedinUrl"
      },
      "plugins": [
        {
          "type": "web-search",
          "query": "site:linkedin.com/in/ {{decisionMaker.firstName}} {{decisionMaker.lastName}} {{companyName}} -inurl:company",
          "limit": 5,
          "selectPrompt": "Select the LinkedIn personal profile for {{decisionMaker.firstName}} {{decisionMaker.lastName}} at {{companyName}}. The URL MUST contain '/in/'. Do NOT select company pages (containing '/company/'). If the specific person is not found, do not select anything."
        }
      ]
    }
  ]
}
